<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Control Panel</title>
  <link rel="icon" type="image/x-icon" sizes="400x400" href="../static/icons/logo.png">
  <link rel="stylesheet" href="/static/styles/controlPnl.css">
  <style>
    body {
      font-family: 'Courier New', Courier, monospace;

    }

    .checkbox-container {
      display: flex;
      align-items: center;
      gap: 10px;

    }

    .dark {
      color: black;
    }

    .toggle-button {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 20px;
      background-color: #ccc;
      border-radius: 15px;
      transition: background-color 0.3s;
      cursor: pointer;

    }

    #toggleButton {
      padding: 0.5rem;
    }

    .toggle-button::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 50%;
      height: 100%;
      background-color: #fff;
      border-radius: 50%;
      transition: transform 0.3s;
    }

    .toggle-button.on::before {
      transform: translateX(100%);
      background: rgb(9, 233, 17);
    }

    .selecLevel {
      padding: 0.5rem 1rem;
      text-align: right;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .selecLevel select {
      padding: 0.5rem;
      background-color: black;
      color: white;
      font-weight: bold;
    }

    .loadingScreen {
      background: #474646cc;
      backdrop-filter: blur(10px);
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    #loadingMessage {
      margin: auto;
      width: 50vw;
      padding: 1.5rem;
    }



    .indicator {
      width: 50%;
      height: 70%;
      margin: auto;
      margin-top: 1rem;
      display: none;
    }

    .indicator svg {
      width: 20%;

    }


    .vectorchange {
      background: #ea0e0ecc;
      backdrop-filter: blur(10px);
      display: flex;
      justify-content: center;
      margin-top: 0.5rem;
      padding: 0.5rem;
      text-transform: capitalize;
      display: none;
      overflow: hidden;
    }

    .vectorText {
      animation: moveText 20s ease infinite alternate;
    }

    @keyframes moveText {
      0% {
        transform: translateX(0%);
      }

      50% {
        transform: translateX(60%);
      }

      100% {
        transform: translateX(0%);
      }
    }

    /* ............................ */
  </style>
</head>

<body>

  <div class="headingBox">
    <h1>Control Panel</h1>
    <div>

      {% if role == 'admin' %}
      <label class="dark">WhiteList </label>
      <button id="toggleButton" class="toggle-button {% if flag %}on{% else %}off{% endif %}" onclick="toggleButton()">
      </button>
      <a href="/admin_list" onclick="playSoundEffect(interfaceSound);">
        <button id="">Admin</button>
      </a>
      <a href="/map" onclick="playSoundEffect(interfaceSound);">
        <button id="">Map</button>
      </a>
      {% endif %}


      <button>
        <a href="/chat" onclick="playSoundEffect(interfaceSound);">Home Page</a>
      </button>
      <button id="myBtn">Recover Password</button>
      <button id="logout">Logout</button>


    </div>
  </div>







  {% if role=='admin' %}
  <div class="loadingScreen">
    <h1 id="loadingMessage">Loading...</h1>

    <div class="indicator">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
        style="margin:auto;background:#ffffff00;display:block;" preserveAspectRatio="xMidYMid">
        <circle cx="6.451612903225806" cy="50" r="3" fill="#941946">
          <animate attributeName="r" times="0;0.5;1" values="2.4000000000000004;3.5999999999999996;2.4000000000000004"
            dur="2s" repeatCount="indefinite" begin="-0.5s"></animate>
          <animate attributeName="cy" keyTimes="0;0.5;1" values="32;68;32" dur="2s" repeatCount="indefinite" begin="0s"
            keySplines="0.5 0 0.5 1;0.5 0 0.5 1" calcMode="spline"></animate>
          <animate attributeName="fill" keyTimes="0;0.5;1" values="#941946;#fbacc9;#941946" dur="2s"
            repeatCount="indefinite" begin="-0.5s"></animate>
        </circle>
        <circle cx="6.451612903225806" cy="50" r="3" fill="#a2f0fb">
          <animate attributeName="r" times="0;0.5;1" values="2.4000000000000004;3.5999999999999996;2.4000000000000004"
            dur="2s" repeatCount="indefinite" begin="-1.5s"></animate>
          <animate attributeName="cy" keyTimes="0;0.5;1" values="32;68;32" dur="2s" repeatCount="indefinite" begin="-1s"
            keySplines="0.5 0 0.5 1;0.5 0 0.5 1" calcMode="spline"></animate>
          <animate attributeName="fill" keyTimes="0;0.5;1" values="#a2f0fb;#164ba3;#a2f0fb" dur="2s"
            repeatCount="indefinite" begin="-0.5s"></animate>
        </circle>
        <circle cx="16.129032258064512" cy="50" r="3" fill="#941946">
          <animate attributeName="r" times="0;0.5;1" values="2.4000000000000004;3.5999999999999996;2.4000000000000004"
            dur="2s" repeatCount="indefinite" begin="-0.7s"></animate>
          <animate attributeName="cy" keyTimes="0;0.5;1" values="32;68;32" dur="2s" repeatCount="indefinite"
            begin="-0.2s" keySplines="0.5 0 0.5 1;0.5 0 0.5 1" calcMode="spline"></animate>
          <animate attributeName="fill" keyTimes="0;0.5;1" values="#941946;#fbacc9;#941946" dur="2s"
            repeatCount="indefinite" begin="-0.7s"></animate>
        </circle>
        <circle cx="16.129032258064512" cy="50" r="3" fill="#a2f0fb">
          <animate attributeName="r" times="0;0.5;1" values="2.4000000000000004;3.5999999999999996;2.4000000000000004"
            dur="2s" repeatCount="indefinite" begin="-1.7s"></animate>
          <animate attributeName="cy" keyTimes="0;0.5;1" values="32;68;32" dur="2s" repeatCount="indefinite"
            begin="-1.2s" keySplines="0.5 0 0.5 1;0.5 0 0.5 1" calcMode="spline"></animate>
          <animate attributeName="fill" keyTimes="0;0.5;1" values="#a2f0fb;#164ba3;#a2f0fb" dur="2s"
            repeatCount="indefinite" begin="-0.7s"></animate>
        </circle>
        <circle cx="25.806451612903224" cy="50" r="3" fill="#941946">
          <animate attributeName="r" times="0;0.5;1" values="2.4000000000000004;3.5999999999999996;2.4000000000000004"
            dur="2s" repeatCount="indefinite" begin="-0.9s"></animate>
          <animate attributeName="cy" keyTimes="0;0.5;1" values="32;68;32" dur="2s" repeatCount="indefinite"
            begin="-0.4s" keySplines="0.5 0 0.5 1;0.5 0 0.5 1" calcMode="spline"></animate>
          <animate attributeName="fill" keyTimes="0;0.5;1" values="#941946;#fbacc9;#941946" dur="2s"
            repeatCount="indefinite" begin="-0.9s"></animate>
        </circle>
        <circle cx="25.806451612903224" cy="50" r="3" fill="#a2f0fb">
          <animate attributeName="r" times="0;0.5;1" values="2.4000000000000004;3.5999999999999996;2.4000000000000004"
            dur="2s" repeatCount="indefinite" begin="-1.9s"></animate>
          <animate attributeName="cy" keyTimes="0;0.5;1" values="32;68;32" dur="2s" repeatCount="indefinite"
            begin="-1.4s" keySplines="0.5 0 0.5 1;0.5 0 0.5 1" calcMode="spline"></animate>
          <animate attributeName="fill" keyTimes="0;0.5;1" values="#a2f0fb;#164ba3;#a2f0fb" dur="2s"
            repeatCount="indefinite" begin="-0.9s"></animate>
        </circle>
        <circle cx="35.48387096774193" cy="50" r="3" fill="#941946">
          <animate attributeName="r" times="0;0.5;1" values="2.4000000000000004;3.5999999999999996;2.4000000000000004"
            dur="2s" repeatCount="indefinite" begin="-1.1s"></animate>
          <animate attributeName="cy" keyTimes="0;0.5;1" values="32;68;32" dur="2s" repeatCount="indefinite"
            begin="-0.6s" keySplines="0.5 0 0.5 1;0.5 0 0.5 1" calcMode="spline"></animate>
          <animate attributeName="fill" keyTimes="0;0.5;1" values="#941946;#fbacc9;#941946" dur="2s"
            repeatCount="indefinite" begin="-1.1s"></animate>
        </circle>
        <circle cx="35.48387096774193" cy="50" r="3" fill="#a2f0fb">
          <animate attributeName="r" times="0;0.5;1" values="2.4000000000000004;3.5999999999999996;2.4000000000000004"
            dur="2s" repeatCount="indefinite" begin="-2.1s"></animate>
          <animate attributeName="cy" keyTimes="0;0.5;1" values="32;68;32" dur="2s" repeatCount="indefinite"
            begin="-1.6s" keySplines="0.5 0 0.5 1;0.5 0 0.5 1" calcMode="spline"></animate>
          <animate attributeName="fill" keyTimes="0;0.5;1" values="#a2f0fb;#164ba3;#a2f0fb" dur="2s"
            repeatCount="indefinite" begin="-1.1s"></animate>
        </circle>
        <circle cx="45.16129032258064" cy="50" r="3" fill="#941946">
          <animate attributeName="r" times="0;0.5;1" values="2.4000000000000004;3.5999999999999996;2.4000000000000004"
            dur="2s" repeatCount="indefinite" begin="-1.3s"></animate>
          <animate attributeName="cy" keyTimes="0;0.5;1" values="32;68;32" dur="2s" repeatCount="indefinite"
            begin="-0.8s" keySplines="0.5 0 0.5 1;0.5 0 0.5 1" calcMode="spline"></animate>
          <animate attributeName="fill" keyTimes="0;0.5;1" values="#941946;#fbacc9;#941946" dur="2s"
            repeatCount="indefinite" begin="-1.3s"></animate>
        </circle>
        <circle cx="45.16129032258064" cy="50" r="3" fill="#a2f0fb">
          <animate attributeName="r" times="0;0.5;1" values="2.4000000000000004;3.5999999999999996;2.4000000000000004"
            dur="2s" repeatCount="indefinite" begin="-2.3s"></animate>
          <animate attributeName="cy" keyTimes="0;0.5;1" values="32;68;32" dur="2s" repeatCount="indefinite"
            begin="-1.8s" keySplines="0.5 0 0.5 1;0.5 0 0.5 1" calcMode="spline"></animate>
          <animate attributeName="fill" keyTimes="0;0.5;1" values="#a2f0fb;#164ba3;#a2f0fb" dur="2s"
            repeatCount="indefinite" begin="-1.3s"></animate>
        </circle>
        <circle cx="54.838709677419345" cy="50" r="3" fill="#941946">
          <animate attributeName="r" times="0;0.5;1" values="2.4000000000000004;3.5999999999999996;2.4000000000000004"
            dur="2s" repeatCount="indefinite" begin="-1.5s"></animate>
          <animate attributeName="cy" keyTimes="0;0.5;1" values="32;68;32" dur="2s" repeatCount="indefinite" begin="-1s"
            keySplines="0.5 0 0.5 1;0.5 0 0.5 1" calcMode="spline"></animate>
          <animate attributeName="fill" keyTimes="0;0.5;1" values="#941946;#fbacc9;#941946" dur="2s"
            repeatCount="indefinite" begin="-1.5s"></animate>
        </circle>
        <circle cx="54.838709677419345" cy="50" r="3" fill="#a2f0fb">
          <animate attributeName="r" times="0;0.5;1" values="2.4000000000000004;3.5999999999999996;2.4000000000000004"
            dur="2s" repeatCount="indefinite" begin="-2.5s"></animate>
          <animate attributeName="cy" keyTimes="0;0.5;1" values="32;68;32" dur="2s" repeatCount="indefinite" begin="-2s"
            keySplines="0.5 0 0.5 1;0.5 0 0.5 1" calcMode="spline"></animate>
          <animate attributeName="fill" keyTimes="0;0.5;1" values="#a2f0fb;#164ba3;#a2f0fb" dur="2s"
            repeatCount="indefinite" begin="-1.5s"></animate>
        </circle>
        <circle cx="64.51612903225805" cy="50" r="3" fill="#941946">
          <animate attributeName="r" times="0;0.5;1" values="2.4000000000000004;3.5999999999999996;2.4000000000000004"
            dur="2s" repeatCount="indefinite" begin="-1.7s"></animate>
          <animate attributeName="cy" keyTimes="0;0.5;1" values="32;68;32" dur="2s" repeatCount="indefinite"
            begin="-1.2s" keySplines="0.5 0 0.5 1;0.5 0 0.5 1" calcMode="spline"></animate>
          <animate attributeName="fill" keyTimes="0;0.5;1" values="#941946;#fbacc9;#941946" dur="2s"
            repeatCount="indefinite" begin="-1.7s"></animate>
        </circle>
        <circle cx="64.51612903225805" cy="50" r="3" fill="#a2f0fb">
          <animate attributeName="r" times="0;0.5;1" values="2.4000000000000004;3.5999999999999996;2.4000000000000004"
            dur="2s" repeatCount="indefinite" begin="-2.7s"></animate>
          <animate attributeName="cy" keyTimes="0;0.5;1" values="32;68;32" dur="2s" repeatCount="indefinite"
            begin="-2.2s" keySplines="0.5 0 0.5 1;0.5 0 0.5 1" calcMode="spline"></animate>
          <animate attributeName="fill" keyTimes="0;0.5;1" values="#a2f0fb;#164ba3;#a2f0fb" dur="2s"
            repeatCount="indefinite" begin="-1.7s"></animate>
        </circle>
        <circle cx="74.19354838709677" cy="50" r="3" fill="#941946">
          <animate attributeName="r" times="0;0.5;1" values="2.4000000000000004;3.5999999999999996;2.4000000000000004"
            dur="2s" repeatCount="indefinite" begin="-1.9s"></animate>
          <animate attributeName="cy" keyTimes="0;0.5;1" values="32;68;32" dur="2s" repeatCount="indefinite"
            begin="-1.4s" keySplines="0.5 0 0.5 1;0.5 0 0.5 1" calcMode="spline"></animate>
          <animate attributeName="fill" keyTimes="0;0.5;1" values="#941946;#fbacc9;#941946" dur="2s"
            repeatCount="indefinite" begin="-1.9s"></animate>
        </circle>
        <circle cx="74.19354838709677" cy="50" r="3" fill="#a2f0fb">
          <animate attributeName="r" times="0;0.5;1" values="2.4000000000000004;3.5999999999999996;2.4000000000000004"
            dur="2s" repeatCount="indefinite" begin="-2.9s"></animate>
          <animate attributeName="cy" keyTimes="0;0.5;1" values="32;68;32" dur="2s" repeatCount="indefinite"
            begin="-2.4s" keySplines="0.5 0 0.5 1;0.5 0 0.5 1" calcMode="spline"></animate>
          <animate attributeName="fill" keyTimes="0;0.5;1" values="#a2f0fb;#164ba3;#a2f0fb" dur="2s"
            repeatCount="indefinite" begin="-1.9s"></animate>
        </circle>
        <circle cx="83.87096774193547" cy="50" r="3" fill="#941946">
          <animate attributeName="r" times="0;0.5;1" values="2.4000000000000004;3.5999999999999996;2.4000000000000004"
            dur="2s" repeatCount="indefinite" begin="-2.1s"></animate>
          <animate attributeName="cy" keyTimes="0;0.5;1" values="32;68;32" dur="2s" repeatCount="indefinite"
            begin="-1.6s" keySplines="0.5 0 0.5 1;0.5 0 0.5 1" calcMode="spline"></animate>
          <animate attributeName="fill" keyTimes="0;0.5;1" values="#941946;#fbacc9;#941946" dur="2s"
            repeatCount="indefinite" begin="-2.1s"></animate>
        </circle>
        <circle cx="83.87096774193547" cy="50" r="3" fill="#a2f0fb">
          <animate attributeName="r" times="0;0.5;1" values="2.4000000000000004;3.5999999999999996;2.4000000000000004"
            dur="2s" repeatCount="indefinite" begin="-3.1s"></animate>
          <animate attributeName="cy" keyTimes="0;0.5;1" values="32;68;32" dur="2s" repeatCount="indefinite"
            begin="-2.6s" keySplines="0.5 0 0.5 1;0.5 0 0.5 1" calcMode="spline"></animate>
          <animate attributeName="fill" keyTimes="0;0.5;1" values="#a2f0fb;#164ba3;#a2f0fb" dur="2s"
            repeatCount="indefinite" begin="-2.1s"></animate>
        </circle>
        <circle cx="93.54838709677418" cy="50" r="3" fill="#941946">
          <animate attributeName="r" times="0;0.5;1" values="2.4000000000000004;3.5999999999999996;2.4000000000000004"
            dur="2s" repeatCount="indefinite" begin="-2.3s"></animate>
          <animate attributeName="cy" keyTimes="0;0.5;1" values="32;68;32" dur="2s" repeatCount="indefinite"
            begin="-1.8s" keySplines="0.5 0 0.5 1;0.5 0 0.5 1" calcMode="spline"></animate>
          <animate attributeName="fill" keyTimes="0;0.5;1" values="#941946;#fbacc9;#941946" dur="2s"
            repeatCount="indefinite" begin="-2.3s"></animate>
        </circle>
        <circle cx="93.54838709677418" cy="50" r="3" fill="#a2f0fb">
          <animate attributeName="r" times="0;0.5;1" values="2.4000000000000004;3.5999999999999996;2.4000000000000004"
            dur="2s" repeatCount="indefinite" begin="-3.3s"></animate>
          <animate attributeName="cy" keyTimes="0;0.5;1" values="32;68;32" dur="2s" repeatCount="indefinite"
            begin="-2.8s" keySplines="0.5 0 0.5 1;0.5 0 0.5 1" calcMode="spline"></animate>
          <animate attributeName="fill" keyTimes="0;0.5;1" values="#a2f0fb;#164ba3;#a2f0fb" dur="2s"
            repeatCount="indefinite" begin="-2.3s"></animate>
        </circle>
      </svg>
    </div>
  </div>
  <div class="vectorchange">
    <p class="vectorText"></p>
  </div>
  <input type="hidden" id="userRole" value="{{ session['role'] }}">
  <div class="selecLevel">
    <div>
      <select id="userSelect" onchange="updateUserContext()">
        <option value="">Select a User</option>
        {% for user in users %}
        <option value="{{ user }}" {% if user==instanceRunning %}selected{% endif %}>
          {{ user }}
        </option>
        {% endfor %}
      </select>
    </div>
   <div>

    <select id="levelSelect">
      <option value="level1" {% if layer=='level1' %} selected {% endif %}>Level1 Only</option>
      <option value="level2" {% if layer=='level2' %} selected {% endif %}>Level2 Only</option>
      <option value="allLevel" {% if layer=='allLevel' %} selected {% endif %}> Level1 + Level2</option>
      <option value="bothLevels" {% if layer=='bothLevels' %} selected {% endif %}>Both Level1 and Level2</option>

    </select>
   </div>
  
  </div>

  {% endif %}



  {% if role=='admin' %}

  <form id="configForm" class="config-form" action="/update_config" method="POST">
    <h2>Update Configuration</h2>
    <div class="config-section">
      <div class="config-block">
        <h3 id="layer_1">Layer 1 Configuration</h3>
        <label for="layer1FolderUrl">Layer 1 Google Drive Folder URL:</label>
        <input type="text" id="layer1FolderUrl" name="layer1DriveURL"
          value="{{ config_data.get('layer1DriveURL', "") }}" placeholder="Enter Layer 1 Google Drive Folder URL"
          required>
        <label for="layer1URL">Layer 1 URL:</label>
        <input type="text" id="layer1URL" name="layer1URL" placeholder="Enter Layer 1 Google Drive Folder URL"
          value="{{ config_data.get('layer1URL', "") }}" required>
        <label for="layer1AuthKey">Layer 1 Auth Key:</label>
        <input type="text" id="layer1AuthKey" name="layer1AuthKey" placeholder="Enter layer_1_auth_key"
          value="{{ config_data.get('layer1AuthKey', "") }}" required>
        <label for="classNamelayer1">Class Name 1:</label>
        <input type="text" id="classNamelayer1" name="classNamelayer1" placeholder="Enter className1"
          value="{{ config_data.get('classNamelayer1', "") }}" required>
        <div class="checkbox-container">
          <input type="checkbox" id="myCheckbox" name="myCheckbox" {{ 'checked' if config_data.get('process_image',
            False) else '' }}>
          <label for="myCheckbox">Process image Layer1</label>

        </div>
        <div class="slider-container">
          <label for="layer1Slider">Layer 1:</label>
          <input type="range" id="layer1Slider" name="layer1Slider" min="0" max="1000" value="0"
            value="{{ config_data.get('layer1SliderValue', "") }}">
          <span id="layer1SliderValue">{{ config_data.get('layer1SliderValue', 0) }}</span>



        </div>
        <button type="button" id="updateAndDownloadButton">Update Configuration & Download Files</button>
        <button id="vector1">Verctorize Layer1</button>
      </div>
      <div class="config-block">
        <h3>Layer 2 Configuration</h3>
        <label for="layer2FolderUrl">Layer 2 Google Drive Folder URL:</label>
        <input type="text" id="layer2FolderUrl" name="layer2DriveURL"
          value="{{ config_data1.get('layer2DriveURL', "")}}" placeholder="Enter Layer 2 Google Drive Folder URL"
          required>
        <label for="layer2URL">Layer 2 URL:</label>
        <input type="text" id="layer2URL" name="layer2URL" placeholder="Enter layer_2 url"
          value="{{ config_data1.get('layer2URL', "")}}" required>
        <label for="layer2AuthKey">Layer 2 Auth Key:</label>
        <input type="text" id="layer2AuthKey" name="layer2AuthKey" placeholder="Enter layer_2_auth_key"
          value="{{ config_data1.get('layer2AuthKey', "")}}" required>
        <label for="classNamelayer2">Class Name 2:</label>
        <input type="text" id="classNamelayer2" name="classNamelayer2" placeholder="Enter className2"
          value="{{ config_data1.get('classNamelayer2', "")}}" required>

        <div class="checkbox-container">
          <input type="checkbox" id="myCheckboxlayer2" name="myCheckboxlayer2" {{ 'checked' if
            config_data1.get('process_image', False) else '' }}>
          <label for="myCheckboxlayer2">Process image Layer2</label>

        </div>
        <div class="slider-container">
          <label for="layer2Slider">Layer 2:</label>
          <input type="range" id="layer2Slider" name="layer2Slider" min="0" max="1000" value="0"
            value="{{ config_data1.get('layer2SliderValue', "")}}">
          <span id="layer2SliderValue">{{ config_data1.get('layer2SliderValue', 0) }}</span>


        </div>

        <button type="button" id="updateAndDownloadButtonLayer2">Update Configuration & Download Files</button>
        <button id="vector2">Verctorize Layer2</button>
      </div>


    </div>

  </form>

  {% endif %}
  <div>
    {% if role == 'admin' %}
    <h1>Update OpenAI Key</h1>
    <form id="openaikey_form" method="post">
      <label for="openaiKey">OpenAI Key:</label>
      <input type="text" name="openaiKey" id="openaiKey" placeholder="Enter OpenAI key"
        value="{{ openAIkey if openAIkey else '' }}" required>
      <input id="openAIbtn" type="submit" value="Update OpenAI Key">
    </form>
    {% endif %}
  </div>


  <div>
    {% if role=='admin' %}
    <h1>Upload a Synonym File</h1>
    <form action="/receive_synonym_file" method="post" enctype="multipart/form-data">
      <input type="file" name="file">
      <input id="synoymUploadbtn"  type="submit" value="Upload">
    </form>
    {% endif %}
  </div>

  <div id="myModal" class="modal">

    <!-- Modal content -->
    <div class="modal-content">
      <span class="close">&times;</span>
      <form action="/update_password" method="POST">
        <div class="form-group">
          <label for="email">Email:</label>
          <input style="width: 300px;height: 30px;" type="email" id="email" name="email" placeholder="Enter your email"
            required value={{userLogin}}>
        </div>
        <div class="form-group">
          <label for="new_password">New Password:</label>
          <input style="width: 300px;height: 30px;" type="password" id="new_password" name="new_password"
            placeholder="Enter new password" required>
        </div>

      </form>
    </div>

  </div>
  <div id="pageContent">


    <form action="/control_panel" method="post">
      <label for="language">Language:</label><br />
      <select id="language" name="language" value="{{ language }}">
        <option value="arabic" {% if language=='ar' %}selected{% endif %}>Arabic</option>
        <option value="kannada" {% if language=='kn' %}selected{% endif %}>Kannada</option>
        <option value="telugu" {% if language=='te' %}selected{% endif %}>Telugu</option>
        <option value="spanish" {% if language=='es' %}selected{% endif %}>Spanish</option>
        <option value="hebrew" {% if language=='he' %}selected{% endif %}>Hebrew</option>
        <option value="japanese" {% if language=='ja' %}selected{% endif %}>Japanese</option>
        <option value="korean" {% if language=='ko' %}selected{% endif %}>Korean</option>
        <option value="hindi" {% if language=='hi' %}selected{% endif %}>Hindi</option>
        <option value="bengali" {% if language=='bn' %}selected{% endif %}>Bengali</option>
        <option value="tamil" {% if language=='ta' %}selected{% endif %}>Tamil</option>
        <option value="urdu" {% if language=='ur' %}selected{% endif %}>Urdu</option>
        <option value="chinese" {% if language=='zh-CN' %}selected{% endif %}>Chinese</option>
        <option value="french" {% if language=='fr' %}selected{% endif %}>French</option>
        <option value="german" {% if language=='de' %}selected{% endif %}>German</option>
        <option value="english" {% if language=='en' %}selected{% endif %}>English</option>
      </select><br />



      {% if role=='admin' %}
      <label for="intro">Introduction Text:</label><br />
      <textarea id="intro" name="intro" rows="4" cols="50">{{ intro }}</textarea><br />

      <label for="title">Name:</label><br />
      <textarea placeholder="Enter the Project Name" id="title" name="title" rows="2"
        cols="5">{{ name }}</textarea><br />

      <label for="prompt_level1">Level 1 Prompt:</label><br />
      <textarea id="prompt_level1" name="prompt_level1" rows="4" cols="50">{{ prompt_level1 }}</textarea><br />

      <label for="prompt_level2">Level 2 Prompt:</label><br />
      <textarea id="prompt_level2" name="prompt_level2" rows="4" cols="50">{{ prompt_level2 }}</textarea><br />

      <label for="prompt_level3">Level 3 Prompt:</label><br />
      <textarea id="prompt_level3" name="prompt_level3" rows="4" cols="50">{{ prompt_level3 }}</textarea><br />

      <label for="text_level1">Level 1 Text:</label><br />
      <textarea id="text_level1" name="text_level1" rows="4" cols="50">{{ text_level1 }}</textarea><br />

      <label for="text_level2">Level 2 Text:</label><br />
      <textarea id="text_level2" name="text_level2" rows="4" cols="50">{{ text_level2 }}</textarea><br />

      <label for="level2_search_prompt">Level 2 search prompt:</label><br />
      <textarea id="level2_search_prompt" name="level2_search_prompt" rows="4"
        cols="50">{{ level2_search_prompt }}</textarea><br />

      {% endif %}

      <!-- <input type="submit" value="Submit" /> -->
      <input id="allSubmitbutton" type="submit" value="Submit" onclick="playSoundEffect(submitSound);" />

    </form>
  </div>
  <script>
    const submitSound = "/static/sounds/submit.mp3";
    const interfaceSound = "/static/sounds/bubble.mp3";
    // const interfaceSound = "bubble.mp3";
    // const submitSound = "bubble.mp3";

    function playSoundEffect(audioUrl) {
      console.log("Playing", audioUrl)
      var audio = new Audio(audioUrl);
      audio.play();
    }



  </script>
</body>
<script>
  var modal = document.getElementById("myModal");


  var btn = document.getElementById("myBtn");

  var span = document.getElementsByClassName("close")[0];

  var content = document.getElementById("pageContent");

  const selectlevel = document.getElementById('levelSelect')

  const vectorChange = document.querySelector('.vectorchange')

  let vectorText = document.querySelector('.vectorText')

  let loadingStatus = document.getElementById("loadingMessage")

  const vector1 = document.getElementById('vector1')
  const vector2 = document.getElementById('vector2')

  let username = document.getElementById("email")

  let currentInstance = document.getElementById("userSelect")

  let allSubmitbutton = document.getElementById("allSubmitbutton")

  let synoymUploadbtn = document.getElementById("synoymUploadbtn")

  let openAIbtn = document.getElementById("openAIbtn")


  btn.onclick = function () {
    modal.style.display = "block";
    content.classList.add("blur-effect"); // Add blur effect
  }

  span.onclick = function () {
    modal.style.display = "none";
    content.classList.remove("blur-effect"); // Remove blur effect
  }

  window.onclick = function (event) {
    if (event.target == modal) {
      modal.style.display = "none";
      content.classList.remove("blur-effect"); // Remove blur effect
    }
  }

  document.getElementById('logout').addEventListener('click', (e) => {
    e.preventDefault();
    fetch('/logout')
      .then(() => {
        // After successful logout, redirect to the login page
        window.location.href = '/login';
      })
      .catch((err) => {
        console.error('Error:', err);
      });
  });

  let intervalID = null;

  document.getElementById("updateAndDownloadButton").addEventListener('click', function (event) {
    event.preventDefault();
    document.getElementById("updateAndDownloadButton").disabled = true;
    document.getElementById("updateAndDownloadButtonLayer2").disabled = true;
    processDrive("layer1")
  });

  const loadingScreen = document.querySelector('.loadingScreen')


  function processDrive(layer) {
    document.getElementById('loadingMessage').innerText = "Loading...";
    // Disable buttons and change color
    disableButton(vector1,vector2)
    intervalID = setInterval(updateLoadingStatus, 5000)
    var formData = new FormData(document.getElementById('configForm'));

    fetch(`/update_files?layer=${layer}`, {
      method: 'POST',
      body: formData
    })
      .then(response => {
        enableButton(vector1,vector2)
        document.getElementById('loadingMessage').innerText = 'Vectorizing Files...';
        setTimeout(() => {
          document.getElementById('loadingMessage').innerText = "Ready to use...";
        }, 1500)

        if (!response.ok) {
          throw new Error('Configuration update failed.');
        }
        console.log(response);
        if(username?.value!== currentInstance?.value){
          disableButton(vector1,vector2)
          make_disable_button(allSubmitbutton)
          make_disable_button(synoymUploadbtn)
          make_disable_button(openAIbtn)
        }
      })
      .catch(error => {

        console.log(error)

        enableButton(vector1,vector2)
        console.error('Error:', error);
        document.getElementById('loadingMessage').innerText = "Failed...";
        vectorText.innerText = ""
        clearInterval(intervalID)
        if(username?.value!== currentInstance?.value){
          disableButton(vector1,vector2)
          make_disable_button(allSubmitbutton)
          make_disable_button(synoymUploadbtn)
          make_disable_button(openAIbtn)
        }
      });
  }


  document.getElementById("updateAndDownloadButtonLayer2").addEventListener('click', function (event) {
    event.preventDefault();
    processDrive("layer2")
  });


  const userRole = document.getElementById('userRole').value;
  console.log('User role:', userRole);

  if (userRole === 'admin') {
    intervalID = setInterval(updateLoadingStatus, 5000)
  }

  function parseTimestamp(timestamp) {
    const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];

    // Split the timestamp into date and time parts
    const [datePart, timePart] = timestamp.split('T');

    // Split the date part into year, month, and day
    const [year, month, day] = datePart.split('-');

    // Split the time part into hours, minutes, seconds, and milliseconds
    const [time, milliseconds] = timePart.split('.');
    const [hours, minutes] = time.split(':');

    // Convert hours to 12-hour format and determine AM/PM
    const ampm = parseInt(hours) >= 12 ? 'PM' : 'AM';
    const displayHours = parseInt(hours) % 12 || 12;

    const monthName = months[parseInt(month) - 1];

    const dateString = `${day}-${monthName}-${year}`;

    const timeString = `${displayHours}:${minutes} ${ampm}`;

    return `${dateString} ${timeString}`;
  }





  function updateLoadingStatus() {
    fetch('/loading_status')
      .then(response => response.json())
      .then(data => {
        // Update the loading status in the HTML
        let text = `${data.vectorFileChange?.userName} has start vectorzation for ${data.vectorFileChange?.layer} at ${parseTimestamp(data.vectorFileChange?.time)}`
        console.log(text)
        vectorText.innerText = text

        document.getElementById('loadingMessage').innerText = data.status;
        console.log(data, 'loading status')

        if (data?.status.toLowerCase().includes('ready') || data?.status.toLowerCase().includes('failed') || data?.status.toLowerCase().includes('api')) {
          vectorChange.style.display = "none"
          enableButton(vector1, vector2)
          clearInterval(intervalID)
          
          if(username?.value!== currentInstance?.value){
          disableButton(vector1,vector2)
          make_disable_button(allSubmitbutton)
          make_disable_button(synoymUploadbtn)
          make_disable_button(openAIbtn)
        }
        } else {
          vectorChange.style.display = 'block'

        }
      })
      .catch(error => {
        console.error('Error fetching loading status:', error);
      });
  }



  const layer1Slider = document.getElementById("layer1Slider");
  const layer1SliderValue = document.getElementById("layer1SliderValue");

  // Add event listener to the range input
  layer1Slider.addEventListener("input", function () {
    layer1SliderValue.textContent = this.value;
  });


  const layer2Slider = document.getElementById("layer2Slider");
  const layer2SliderValue = document.getElementById("layer2SliderValue");

  // Add event listener to the range input
  layer2Slider.addEventListener("input", function () {
    layer2SliderValue.textContent = this.value;
  });

  function toggleButton() {
    var button = document.getElementById('toggleButton');
    button.classList.toggle('on');
    if (button.classList.contains('on')) {
      // button.textContent = 'ON';
      updateWhiteListStatus(true);
    } else {
      // button.textContent = 'OFF';
      updateWhiteListStatus(false);
    }
  }

  function updateWhiteListStatus(status) {
    fetch('/check_for_whitelList', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ status: status })
    })
      .then(response => {
        if (!response.ok) {
          throw new Error('Failed to update WhiteList status');
        }
        return response.json();
      })
      .then(data => {
        console.log(data, 'success')
      })
      .catch(error => {
        console.error('Error updating WhiteList status:', error);
      });
  }




  selectlevel.addEventListener('change', function () {
    var selectedLevel = selectlevel.value;

    fetch('/changeLayer', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded'
      },
      body: 'selected_level=' + encodeURIComponent(selectedLevel)
    })
      .then(response => response.text())
      .then(data => console.log(data))
      .catch(error => console.error('Error:', error));
  });







  vector1.addEventListener('click', (e) => {
    e.preventDefault()
    verctorizeLayer('layer1')
  })
  vector2.addEventListener('click', (e) => {
    e.preventDefault()
    verctorizeLayer('layer2')
  })


  document.getElementById("updateAndDownloadButton").disabled = true;
  document.getElementById("updateAndDownloadButton").style.backgroundColor = "gray";
  document.getElementById("updateAndDownloadButtonLayer2").disabled = true;
  document.getElementById("updateAndDownloadButtonLayer2").style.backgroundColor = "gray";
  vector1.style.backgroundColor = 'gray'
  vector2.style.backgroundColor = 'gray'
  vector1.disabled = true;
  vector2.disabled = true;


  function verctorizeLayer(layer) {
    document.getElementById('loadingMessage').innerText = "Loading...";

    // Disable buttons and change color
    disableButton(vector1,vector2)
    intervalID = setInterval(updateLoadingStatus, 5000)

    fetch(`/check_for_updates?layer=${layer}`)
      .then(response => {
        if (response.ok) {
          return response.json();
        }
        throw new Error('Request failed.');
      })
      .then(data => {
        console.log(data, 'revector data here --------'); // Process your data here
        enableButton(vector1,vector2)
        loadingStatus.innerText = data?.message
        vectorChange.style.display = "none"
        clearInterval(intervalID)
        if(username?.value!== currentInstance?.value){
          disableButton(vector1,vector2)
        }
      })
      .catch(error => {
        console.log(error);
        enableButton(vector1,vector2)
        loadingStatus.innerText = "Error"
        vectorChange.style.display = "none"
        clearInterval(intervalID)
        if(username?.value!== currentInstance?.value){
          disableButton(vector1,vector2)
          make_disable_button(allSubmitbutton)
          make_disable_button(synoymUploadbtn)
          make_disable_button(openAIbtn)
        }
      });
  }





</script>

</html>



<script>

  function updateUserContext() {
    const selectedUsername = document.getElementById('userSelect').value;
    fetch('/set_user_context', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ username: selectedUsername })
    })
      .then(response => response.json())
      .then(data => {
        if (data.error) {
          console.error('Error updating user context:', data.error);
        } else {
          console.log('Context updated:', data);
          location.reload();
        }
      })
      .catch(error => console.error('Error updating user context:', error));
  }





  let openaikey_form = document.getElementById("openaikey_form");

  openaikey_form.addEventListener('submit', (e) => {
    e.preventDefault();
    var openaiKey = document.getElementById('openaiKey').value;

    console.log(openaiKey, 'key');

    fetch('/update_apikey', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ "openaiKey": openaiKey })
    })
      .then((response) => {
        return response.json();
      })
      .then((data) => {
        alert(data?.message)
        console.log(data);
      })
      .catch((error) => {
        console.log(error);
        alert('Failed to update OpenAI Key');
      });
  });


  function enableButton(vector1,vector2) {
    document.getElementById("updateAndDownloadButton").disabled = false;
    document.getElementById("updateAndDownloadButton").style.backgroundColor = "";
    document.getElementById("updateAndDownloadButtonLayer2").disabled = false;
    document.getElementById("updateAndDownloadButtonLayer2").style.backgroundColor = "";
    vector1.style.backgroundColor = ''
    vector2.style.backgroundColor = ''
    vector1.disabled = false;
    vector2.disabled = false;
  }


  function disableButton(vector1,vector2) {
    document.getElementById("updateAndDownloadButton").disabled = true;
    document.getElementById("updateAndDownloadButton").style.backgroundColor = "gray";
    document.getElementById("updateAndDownloadButtonLayer2").disabled = true;
    document.getElementById("updateAndDownloadButtonLayer2").style.backgroundColor = "gray";
    vector1.style.backgroundColor = 'gray'
    vector2.style.backgroundColor = 'gray'
    vector1.disabled = true;
    vector2.disabled = true;
  }

  
function make_disable_button(button){
  button.style.backgroundColor = "gray";
  button.disabled = true
}

function make_enable_button(button){
  button.style.backgroundColor = "";
  button.disabled = false
}

</script>